<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>qt-motor/qtmotor.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="QtARGB.html">QtARGB</a><ul class='methods'><li data-type='method'><a href="QtARGB.html#argb">argb</a></li></ul></li><li><a href="QtBuzzer.html">QtBuzzer</a><ul class='methods'><li data-type='method'><a href="QtBuzzer.html#buzz">buzz</a></li></ul></li><li><a href="QtLED.html">QtLED</a><ul class='methods'><li data-type='method'><a href="QtLED.html#led">led</a></li></ul></li><li><a href="QtMotor.html">QtMotor</a><ul class='methods'><li data-type='method'><a href="QtMotor.html#run">run</a></li></ul></li><li><a href="QtRGB.html">QtRGB</a><ul class='methods'><li data-type='method'><a href="QtRGB.html#rgb">rgb</a></li></ul></li><li><a href="QtServo.html">QtServo</a><ul class='methods'><li data-type='method'><a href="QtServo.html#sweep">sweep</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">qt-motor/qtmotor.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const motortemplate = document.createElement('template');
motortemplate.innerHTML = `
&lt;link rel='stylesheet' type='text/css' href='https://unpkg.com/tailwindcss@^2.0.3/dist/tailwind.min.css' />
&lt;style>
    input:checked + label {
        background-color: LightSeaGreen;
    }
    .wheels img{
        width: 150px;
        height: 150px;
        animation: wheels 2s linear infinite ;    
    }
    @keyframes wheels {
    100% {
      transform: rotate(360deg);
    }   
  }
&lt;/style>

&lt;div class="box-content rounded-md h-auto w-auto p-4 bg-purple-400 text-center " id="show-hide" style="display: block">
    &lt;div class="grid grid-cols-1 gap-4">
        &lt;div class="box-content rounded-md h-auto w-full bg-yellow-400">
            &lt;p class="text-2xl text-center font-sans font-bold ">DC MOTOR&lt;/p>
        &lt;/div>
    &lt;/div>
    &lt;div class="grid grid-cols-2 gap-1">
        &lt;div>
            &lt;legend class="font-bold">State&lt;/legend>
            &lt;div class="inline-flex text-gray-800" id="state">
                &lt;input class="hidden" type="radio" id="on" value="on" name="state-s"/>
                &lt;label class="bg-gray-300 hover:bg-gray-400 font-semibold py-2 px-3 cursor-pointer rounded-l" for="on">START&lt;/label>
                &lt;input class="hidden" type="radio" id="off" value="off" name="state-s" checked="checked"/>
                &lt;label class="bg-gray-300 hover:bg-gray-400 font-semibold py-2 px-3 cursor-pointer rounded-r" for="off">STOP&lt;/label>
            &lt;/div>
        &lt;/div>
        &lt;div>
        &lt;fieldset class="flex justify-center text-center ">
            &lt;legend class="font-bold">Direction&lt;/legend>
            &lt;div class="inline-flex" id="direction">
                &lt;input class="hidden" type="radio" id="clockwise" value="clockwise" name="state-d"  checked/>
                &lt;label class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-3 cursor-pointer rounded-l" for="clockwise">CLOCKWISE&lt;/label>
                &lt;input class="hidden" type="radio" id="anticlockwise" value="anticlockwise" name="state-d"/>
                &lt;label class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-3 cursor-pointer rounded-r" for="anticlockwise">ANTICLOCKWISE&lt;/label>
            &lt;/div>
        &lt;/fieldset>
        &lt;/div>
        &lt;div>
        &lt;button>
            &lt;legend class="font-bold">Config&lt;/legend>
            &lt;svg id = "config_gear" xmlns="http://www.w3.org/2000/svg" width="auto" height="38" viewBox="0 0 24 24">&lt;path d="M24 13.616v-3.232c-1.651-.587-2.694-.752-3.219-2.019v-.001c-.527-1.271.1-2.134.847-3.707l-2.285-2.285c-1.561.742-2.433 1.375-3.707.847h-.001c-1.269-.526-1.435-1.576-2.019-3.219h-3.232c-.582 1.635-.749 2.692-2.019 3.219h-.001c-1.271.528-2.132-.098-3.707-.847l-2.285 2.285c.745 1.568 1.375 2.434.847 3.707-.527 1.271-1.584 1.438-3.219 2.02v3.232c1.632.58 2.692.749 3.219 2.019.53 1.282-.114 2.166-.847 3.707l2.285 2.286c1.562-.743 2.434-1.375 3.707-.847h.001c1.27.526 1.436 1.579 2.019 3.219h3.232c.582-1.636.75-2.69 2.027-3.222h.001c1.262-.524 2.12.101 3.698.851l2.285-2.286c-.744-1.563-1.375-2.433-.848-3.706.527-1.271 1.588-1.44 3.221-2.021zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/>&lt;/svg>
        &lt;/button>
        &lt;/div>
        &lt;div>
        &lt;button>
            &lt;legend class="font-bold">Simulation&lt;/legend>
            &lt;svg id="simulation_gear" xmlns="http://www.w3.org/2000/svg" width="auto" height="38" fill="none" viewBox="0 0 24 24" stroke="currentColor">&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />&lt;/svg>
        &lt;/button>    
        &lt;/div>     
    &lt;/div>

    &lt;div id="ip-parameters" class="flex flex-col " style="display: none">
        &lt;div class="grid grid-cols-3 gap-10">
            &lt;div class="flex flex-row gap-x-3" >
                &lt;div class="font-sans text-2xl text-left font-bold ">Speed&lt;/div>
                &lt;div class="flex flex-row gap-x-3">
                    &lt;input class="range-slider__range" type="range" min="0" max="255" value="127" id="speed">
                    &lt;span class="range-slider__value" id="slider_val">127&lt;/span>
                &lt;/div>
            &lt;/div>
        &lt;/div>&lt;br>
        &lt;div class="flex flex-row gap-x-8">
        &lt;div class="font-sans text-2xl text-left font-bold ">Board Name&lt;/div>
        &lt;select class="form-select rounded-md box-border" style="width:75px; overflow:hidden" id="board-name">
        &lt;option value="" disabled selected>Select&lt;/option>
        &lt;/select>

        &lt;/div>&lt;br>

        &lt;div class="flex flex-row gap-x-8">
            &lt;div class="font-sans text-2xl text-left font-bold">Port Number&lt;/div>
            &lt;select class="form-select rounded-md box-border" id="port" style="width:75px; overflow:hidden">
                &lt;option value="1">&amp;nbsp;1&amp;nbsp;&lt;/option>
                &lt;option value="2">&amp;nbsp;2&amp;nbsp;&lt;/option>
            &lt;/select>
            &lt;div class="font-sans text-2xl text-left font-bold ">Pin Number&amp;nbsp;&lt;/div>
            &lt;input class="form-input rounded-md box-border"id="pin">
        &lt;/div>&lt;br>
    &lt;/div>

    
    &lt;div class="bg-white rounded border shadow-lg" id="simulation_box" style="display: none">
        &lt;div class="rounded-t bg-blue-500">
        &lt;div class="relative py-3 px-2 flex">
            &lt;span class="font-semibold text-white md:text-base text-sm">Simulation&lt;/span>
            &lt;!--&lt;div class="absolute right-0 top-0 -mr-2 -mt-2 border cursor-pointer shadow-lg bg-white z-10 p-1 rounded-full p-2">
                &lt;img src="https://image.flaticon.com/icons/svg/151/151882.svg"/ class="w-2 h-2">
            &lt;/div>-->
        &lt;/div>
        &lt;/div>
        &lt;div class=" flex bg-gray-400 justify-center  md:text-base text-sm border-b h-full">
            &lt;div class="wheels"> 
                &lt;img src="https://qtlearncodelab.github.io/qtpi-shared/images/wheel.png" id="motor_wheel">
            &lt;/div>
        &lt;/div>
    &lt;/div>
&lt;/div>

&lt;div class=" flex p-10 md:text-base" id="canvassimulation" style="display: none">
    &lt;div class="wheels"> 
        &lt;img src="https://qtlearncodelab.github.io/qtpi-shared/images/wheel.png" id="simulation_motor_wheel">
    &lt;/div>
&lt;/div>


`;
/**
 * QT-Motor webcomponent
 * {@link https://qtlearncodelab.github.io/qtpi-shared/qtwc/motor.html| Click Here for Tutorial}
 */
export class QtMotor extends HTMLElement {
    static get observedAttributes() {
        return ['state', 'pin', 'port', 'board-name', 'ccs','s-style']; //required for v1
    }
    constructor() {
        super();
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(motortemplate.content.cloneNode(true));
        this.shadowRoot.querySelector('#pin').value = this.getAttribute('pin');
        // this.shadowRoot.querySelector('#board-type').value = this.getAttribute('board-type');
        this.shadowRoot.querySelector('#board-name').value = this.getAttribute('board-name');
        this.shadowRoot.querySelector('#port').value = this.getAttribute('port');
        this.shadowRoot.querySelector('#speed').value = this.getAttribute('speed');
        //this.shadowRoot.querySelector('#direction').value = this.getAttribute('direction');
        this.shadowRoot.querySelector('#speed').value = this.getAttribute('speed');
        this.state = this.getAttribute('state'); // Run/stop
        //console.log(this.shadowRoot.querySelector('#direction').value);
        this.direction = this.shadowRoot.querySelector('#direction').value;
        console.log(this.shadowRoot.querySelector('#direction').value);
        this.shadowRoot.getElementById("motor_wheel").style.animationPlayState = "paused";
        this.shadowRoot.getElementById("simulation_motor_wheel").style.animationPlayState = "paused";
    }
    get ccs() {
        console.log("ccs get method");
        return this.getAttribute('ccs');
    }
    set ccs(newValue) {
        console.log("ccs set method", newValue);
        this.setAttribute('ccs', newValue);
    }
    get s_style() {
        console.log("s-style get method");
        return this.getAttribute('s-style');
      }
      set s_style(newValue) {
        console.log("s-style set method", newValue);
        this.setAttribute('s-style', newValue);
      }
    updateStateValue(e) {
        console.log(e.target.id, e.target.value);
        this.state = e.target.value;
        console.log(e.target.value);
        if (e.target.id == "on") {
            console.log("wheel Running");
            this.run();
        } else {
            this.run("clockwise", "0");
            this.shadowRoot.getElementById("motor_wheel").style.animationPlayState = "paused";
            this.shadowRoot.getElementById("simulation_motor_wheel").style.animationPlayState = "paused";
        }
    }

    getParameters() {
        var x = this.shadowRoot.getElementById("ip-parameters");
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
    ccsShow() {
        this.shadowRoot.getElementById("show-hide").style.display = "block";
        this.shadowRoot.getElementById("canvassimulation").style.display = "none";
    }
    ccsHide() {
        this.shadowRoot.getElementById("show-hide").style.display = "none";
        this.shadowRoot.getElementById("canvassimulation").style.display = "block";
    }

    simulate() {
        var x = this.shadowRoot.getElementById('simulation_box');
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
/**
 * * @example 
 * m1.run("clockwise", 255);
 * to start the motor in the given direction with the given speed
 * @param {String} direction - direction of the motor - clockwise/anticlockwise
 * @param {any} speed - speed of the motor
 */
    run(direction = null, speed = null) {
        var elem = this.shadowRoot.getElementById('board-name');
        var selectedIndex = elem.selectedIndex;
        if (selectedIndex == -1) {
        selectedIndex = 0;
        }
        console.log("elem: ", elem.options, selectedIndex);
        var bName = elem.options[selectedIndex].value;
        console.log("led ===> ", bName, window.boards);
        var board = window.boards &amp;&amp; window.boards[bName];
        if (board &amp;&amp; board.port !== "simulated") {
            var pin = this.getAttribute('port')
            if (pin == "1") {
                if(board.type === "veda") {
                    var pin1 = board.pin(4, 'PWM', 'OUTPUT'); //veda pin1
                    var pin2 = board.pin(5, 'PWM', 'OUTPUT'); //veda pin 2
                }else if(board.type === "rio"){
                    var pin1 = board.pin(4, 'DIGITAL', 'OUTPUT'); //rio digital -direction
                    var pin2 = board.pin(5, 'PWM', 'OUTPUT'); //rio analog - speed
                }
            } else {
                if(board.type === "veda") {
                    var pin1 = board.pin(7, 'PWM', 'OUTPUT'); //veda pin 1
                    var pin2 = board.pin(6, 'PWM', 'OUTPUT'); //veda pin 2
                } else if(board.type === "rio"){
                    var pin1 = board.pin(7, 'DIGITAL', 'OUTPUT'); // rio digital direction
                    var pin2 = board.pin(6, 'PWM', 'OUTPUT'); //rio analog - speed
                }
            }
        } else {
            console.log("Board Not Connected");
        }
        var motorState = this.state;
        
        if(motorState === "on") {
            console.log(motorState, direction, speed);
            if (direction == null) {
                direction = this.getAttribute('direction');
                console.log('direction: ', direction);
            }
            if (speed == null) {
                speed = this.getAttribute('speed');
            }
        } else {
            console.log("Motor stopped");
            this.shadowRoot.getElementById("motor_wheel").style.animationPlayState = "paused";
            this.shadowRoot.getElementById("simulation_motor_wheel").style.animationPlayState = "paused";
        }
        
        
        if(direction == true) {
            direction = "clockwise";
        }else if(direction == false) {
            direction = "anticlockwise";
        }
        
        if (speed > 0) {
            if (direction == "anticlockwise") {
                console.log("anticlockwise Running");
                this.shadowRoot.getElementById("motor_wheel").style.animationDirection = "reverse";
                this.shadowRoot.getElementById("motor_wheel").style.animationPlayState = "running";
                
                this.shadowRoot.getElementById("simulation_motor_wheel").style.animationDirection = "reverse";
                this.shadowRoot.getElementById("simulation_motor_wheel").style.animationPlayState = "running";
                if (speed == 0) {
                    var animationspeed = 0;
                } else {
                    var animationspeed = Math.floor((500 / speed));
                }
                this.shadowRoot.getElementById("motor_wheel").style.animationDuration = animationspeed + 's';
                this.shadowRoot.getElementById("simulation_motor_wheel").style.animationDuration = animationspeed + 's';
                if (board &amp;&amp; board.port !== "simulated") {
                    //veda
                    if(board.type === "veda"){
                        pin1.write(0);
                        pin2.write(speed);
                    } else if(board.type === "rio"){
                        pin2.write(speed); // analog speed
                        pin1.write(0); //digital direction
                    }
                }
            } else {
                console.log("clockwise running");
                if (speed == 0) {
                    var animationspeed = 0;
                } else {
                    var animationspeed = Math.floor((500 / speed));
                }
                this.shadowRoot.getElementById("motor_wheel").style.animationDirection = "normal";
                this.shadowRoot.getElementById("motor_wheel").style.animationPlayState = "running";
                this.shadowRoot.getElementById("motor_wheel").style.animationDuration = animationspeed + 's';
                this.shadowRoot.getElementById("simulation_motor_wheel").style.animationDirection = "normal";
                this.shadowRoot.getElementById("simulation_motor_wheel").style.animationPlayState = "running";
                this.shadowRoot.getElementById("simulation_motor_wheel").style.animationDuration = animationspeed + 's';
                if (board &amp;&amp; board.port !== "simulated" ) {
                    if(board.type === "veda"){
                        pin1.write(speed);
                        pin2.write(0);
                        //veda
                    } else if(board.type === "rio"){
                        pin2.write(speed); // analog speed
                        pin1.write(1); //digital direction
                    }

                    
                }
            }
        } else {
            console.log("Motor stopped");
            this.shadowRoot.getElementById("motor_wheel").style.animationPlayState = "paused";
            this.shadowRoot.getElementById("simulation_motor_wheel").style.animationPlayState = "paused";
            if (board &amp;&amp; board.port !== "simulated" ) {
                pin1.write(0);
                pin2.write(0);
            }
        }
    }

    disconnectedCallback() {
        this.shadowRoot.querySelector('#pin').removeEventListener();
        this.shadowRoot.querySelector('#port').removeEventListener();
        this.shadowRoot.querySelector('#board-name').removeEventListener();
        // this.shadowRoot.querySelector('#board-type').removeEventListener();
        this.shadowRoot.querySelector('#state').removeEventListener();
        this.shadowRoot.querySelector('#direction').removeEventListener();
        this.shadowRoot.querySelector('#speed').removeEventListener();
    }

    connectedCallback() {
        var self = this;
        this.shadowRoot.querySelector('#pin').addEventListener('change', function(e) {
            self.updatePinValue(e);
        }, false);
        this.shadowRoot.querySelector('#port').addEventListener('change', function(e) {
            self.updatePortValue(e);
        }, false);
        // this.shadowRoot.querySelector('#board-type').addEventListener('change', function(e) {
        //     self.updateBoardValue(e);
        // }, false);
        this.shadowRoot.querySelector('#board-name').addEventListener('change', function(e) {
            self.updateBoardNameValue(e);
        }, false);
        this.shadowRoot.querySelector('#state').addEventListener('change', function(e) {
            self.updateStateValue(e);
        }, false);

        this.shadowRoot.querySelector('#direction').addEventListener('change', function(e) {
            //console.log(e.target.checked, e.target.value);
            self.updateDirectionValue(e);
        }, false);

        this.shadowRoot.querySelector('#speed').addEventListener('change', function(e) {
            self.updateSpeedValue(e);
        }, false);
        this.shadowRoot.querySelector('#config_gear').addEventListener('click', function(e) {
            self.updateParameters(e);
        }, false);
        this.shadowRoot.querySelector('#simulation_gear').addEventListener('click', function(e) {
            self.displaySimulation(e);
        }, false);
        window.addEventListener('boardConnected', function (e) {
            console.log('boardConnected', e.detail, window.boards);
            
            self.updateBoardNames(e.detail);
            self.run(self.direction,self.speed);
          });
          window.addEventListener('boardDisConnected', function (e) {
            console.log('boardDisConnected', e.detail,window.boards);
            self.updateBoardNames(e.detail);
          });
    }
    simulateCb(dataCb) {
        var port = this.shadowRoot.querySelector('#port').value;
        console.log("simulateCb ------------> ",dataCb.s.d,dataCb.s.s,"rec port",dataCb.s.p,"conf port",port);
        if(parseInt(port) === parseInt(dataCb.s.p)) {
            this.run(dataCb.s.d,dataCb.s.s);
            if (this.getAttribute('onData')) {
                window[this.getAttribute('onData')](dataCb.s);
            }
        }
    }
    updateBoardNames(boardData) {
        var boards = window.boards || {};
        var keys = Object.keys(boards);
        console.log("=== motor updateBoardNames ",boardData);
        var self = this;
        boardData.registerCb("motor",function(dataObj) {self.simulateCb(dataObj);});
        if (keys.length == 0) {
            this.shadowRoot.getElementById("board-name").innerHTML = "&lt;option>&lt;/option>";
        } else {
            var value;
            var boardOptions = "";
            for (value in keys) {
                boardOptions += "&lt;option value='"+ keys[value]+ "'>" + keys[value]  + "(" + boards[keys[value]].type + ")" + "&lt;/option>";
            }
            this.shadowRoot.getElementById("board-name").innerHTML = boardOptions;
        }
      }
    updatePinValue(e) {
        console.log('pin', e.target.value, this);
        this.setAttribute('pin', e.target.value);
    }
    updatePortValue(e) {
        console.log('port', e.target.value);
        this.setAttribute('port', e.target.value);
    }
    // updateBoardValue(e) {
    //     console.log('board', e.target.value);
    //     this.setAttribute('board', e.target.value);
    // }
    updateBoardNameValue(e) {
        console.log('board-name', e.target.value);
        this.setAttribute('board-name', e.target.value);
    }
    updateDirectionValue(e) {
        console.log('direction', e.target.id, e.target.checked);
        console.log(e.target.id);
        if (e.target.id == "anticlockwise") {
            this.setAttribute('direction', "anticlockwise");
        } else {
            this.setAttribute("direction", "clockwise");
        }
        if (this.state == "on") {
            this.run();
        }
    }
    updateSpeedValue(e) {
        console.log('speed', e.target.value);
        this.setAttribute('speed', e.target.value);
        this.shadowRoot.querySelector('#slider_val').innerHTML = e.target.value;
        if (this.state == "on") {
            this.run();
        }
    }
    updateParameters(e) {
        this.getParameters();
    }
    displaySimulation(e) {
        this.simulate();
    }
    attributeChangedCallback(name, oldValue, newValue) {
        console.log("attributeChangedCallback ", name, oldValue, newValue);
        if (name === 'ccs') {
            newValue == "false" ? this.ccsHide() : this.ccsShow();
        }  else if (name === 's-style') {
            console.log("s-style: ", newValue);
            this.shadowRoot.getElementById('canvassimulation').style = newValue;
          }

    }

}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Wed Aug 04 2021 11:49:36 GMT+0530 (India Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
